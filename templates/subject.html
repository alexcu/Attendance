{% extends "layout.html" %}
{% block content %}
    <h1>Subject Information</h1>
    {{ msg }}
    <div class="row">
        <div class="col-md-6">
            <table class="table">
                <thead>
                <td>Subject Code</td>
                <td>Subject Name</td>
                <td>Study Period</td>
                </thead>
                <tr>
                    <td>{{ rows["subcode"] }}</td>
                    <td>{{ rows["subname"] }}</td>
                    <td> {{ rows["studyperiod"] }}</td>
                </tr>
            </table>
        </div>
    </div>
    <a href="{{ url_for('remove_subject', subcode = rows["subcode"]) }}">Delete Subject</a>

    <h1>Tutor</h1>
    <div class="row">
        <div class="col-md-6">
            <table class="table">
                <thead>
                <td>Tutor Name</td>

                <td/>
                </thead>
                <tr>
                    <td>
                        <a href="{{ url_for('view_tutor', tutorid = tutor["id"]) }}">{{ tutor["name"] }}</a>
                    </td>

                    <td>{% if tutor != None %}
                        <a href="{{ url_for('remove_tutor_from_subject', subcode = rows["subcode"], tutorid = tutor["id"]) }}">
                            <button type="button" class="btn btn-default">Remove</button>
                        </a>{% endif %}</td>
                </tr>
            </table>
        </div>
    </div>
    {% if tutor == None %}
        <h3>Add Tutor to Subject</h3>
        <form action="{{ url_for('add_tutor_to_subject', subcode = rows["subcode"]) }}" method="POST">
            <select name="tutor">
                {% for temptutor in tutors %}

                    <option value={{ temptutor["id"] }}>{{ temptutor["name"] }}</option>

                {% endfor %}

            </select>

            <input type="submit" value="Add Tutor to Subject"/>
        </form>
    {% endif %}
    {{ msg2 }}

    <h1>Students Enrolled in this subject</h1>
    <div class="row">
        <div class="col-md-6">
            <form action="{{ url_for('update_student_attendance', subcode = rows["subcode"]) }}" method="post">
            <table class="table">
                <thead>
                <td>Student Number</td>
                <td>Name</td>
                <td/>
                {% for class in classes %}
                    <td id="{{ class.id }}/date" class="classdate">{{ class["classtime"].strftime('%Y-%m-%d') }}</td>
                {% endfor %}
                </thead>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    {% for class in classes %}
                        <td id="{{ class.id }}/time" class="classtime">{{ class["classtime"].strftime('%H:%M') }}</td>
                    {% endfor %}
                </tr>

                {% for student in students %}
                    <tr>

                        <td>
                            <a href="{{ url_for('view_student', studentcode = student.studentcode) }}">{{ student["studentcode"] }}</a>
                        </td>
                        <td>
                            <a href="{{ url_for('view_student', studentcode = student.studentcode) }}">{{ student["firstname"] }} {{ student["lastname"] }}</a>
                        </td>
                        <td>
                            <a href="{{ url_for('remove_student_from_subject', studentcode = student.studentcode, subcode = rows["subcode"]) }}">Remove</a></a>
                        </td>
                        {% for class in classes %}
                            {% if student in attendees[class.id] %}
                                <td class="attended" id="{{ class.id }}/{{ student.id }}"></td>
                            {% else %}
                                <td class="notattended" id="{{ class.id }}/{{ student.id }}"></td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                {% endfor %}
            </table>
                <button type="button" onclick="makeEditable()" name="editbutton">Edit Attendance</button>
                <button type="submit" name="submitbutton" hidden="true">Save Attendance</button>
            </form>
        </div>
    </div>

    {% if tutor != None %}

        <a href="{{ url_for('add_class',subcode = rows["subcode"]) }}">
            <button type="button" class="btn btn-lg btn-default">Add a Class</button>
        </a>


        <h1>Timetable Explorer</h1>
        <div class="row">
            <div class="col-md-6">
                <table class="table">
                    <thead>
                    <td>Monday 7:30pm</td>
                    <td>Monday 8:30pm</td>
                    <td>Monday 9:30pm</td>
                    <td>Tuesday 7:30pm</td>
                    <td>Tuesday 8:30pm</td>
                    <td>Tuesday 9:30pm</td>
                    <td>Wednesday 7:30pm</td>
                    <td>Wednesday 8:30pm</td>
                    <td>Wednesday 9:30pm</td>
                    </thead>
                    <tr>
                        {% if  "Monday 7:30" in times %}
                            <td class="attended"></td>
                        {% else %}
                            <td class="notattended"></td>
                        {% endif %}
                        {% if  "Monday 8:30" in times %}
                            <td class="attended"></td>
                        {% else %}
                            <td class="notattended"></td>
                        {% endif %}
                        {% if  "Monday 9:30" in times %}
                            <td class="attended"></td>
                        {% else %}
                            <td class="notattended"></td>
                        {% endif %}
                        {% if  "Tuesday 7:30" in times %}
                            <td class="attended"></td>
                        {% else %}
                            <td class="notattended"></td>
                        {% endif %}
                        {% if  "Tuesday 8:30" in times %}
                            <td class="attended"></td>
                        {% else %}
                            <td class="notattended"></td>
                        {% endif %}
                        {% if  "Tuesday 9:30" in times %}
                            <td class="attended"></td>
                        {% else %}
                            <td class="notattended"></td>
                        {% endif %}
                        {% if  "Wednesday 7:30" in times %}
                            <td class="attended"></td>
                        {% else %}
                            <td class="notattended"></td>
                        {% endif %}
                        {% if  "Wednesday 8:30" in times %}
                            <td class="attended"></td>
                        {% else %}
                            <td class="notattended"></td>
                        {% endif %}
                        {% if  "Wednesday 9:30" in times %}
                            <td class="attended"></td>
                        {% else %}
                            <td class="notattended"></td>
                        {% endif %}

                    </tr>


                </table>
            </div>
        </div>


        <h1>Timetabled Classes</h1>
        <div class="row">
            <div class="col-md-6">
                <table class="table">
                    <thead>
                    <td>Time</td>
                    <td/>
                    </thead>
                    {% for row in timetabledclasses %}
                        <tr>
                            <td>
                                {{ row['time'] }}
                            </td>


                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    {% endif %}

    <script>
        function makeEditable() {

            var z = document.getElementsByName("editbutton")
            z[0].hidden = true
            var z = document.getElementsByName("submitbutton")
            z[0].hidden = false
            var x = document.getElementsByClassName("attended")
            var y = document.getElementsByClassName("notattended")
            var q = document.getElementsByClassName("classdate")
            var w = document.getElementsByClassName("classtime")
            for (i = 0; i < y.length; i++) {
                y[i].innerHTML = "<input type = 'checkbox' name = 'checkbox" + y[i].id + "' value = '" + y[i].id + "' />";
                y[i].style.backgroundColor = "transparent";
            }
            for (i = 0; i < x.length; i++) {
                x[i].innerHTML = "<input type = 'checkbox' name = 'checkbox" + x[i].id + "' value = '" + x[i].id + "' checked />";
                x[i].style.backgroundColor = "transparent";
            }

            for (i = 0; i < q.length; i++) {
                var date = q[i].innerHTML;
                q[i].innerHTML = "<input type = 'date' name = 'classdate" + q[i].id + "' value = '" + date + "'>";
            }

            for (i = 0; i < w.length; i++) {
                var time = w[i].innerHTML;
                w[i].innerHTML = "<input type = 'time' name = 'classdate" + w[i].id + "' value = '" + time + "'>";
            }

        }


    </script>

{% endblock %}